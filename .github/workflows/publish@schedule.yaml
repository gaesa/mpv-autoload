name: "publish@schedule: Weekly check and possibly publish"

on:
  schedule:
    - cron: "0 0 * * 1"

jobs:
  check-and-publish:
    runs-on: ubuntu-latest
    environment: publish
    steps:
      - name: Trigger publish workflow if necessary
        if: ${{ vars.SHOULD_PUBLISH == "true" }}
        uses: ./.github/workflows/publish.yaml

  Reset-publish-flag:
    needs: check-and-publish
    runs-on: ubuntu-latest
    environment: publish
    steps:
      - if: ${{ vars.SHOULD_PUBLISH == "true" }}
        uses: action-pack/set-variable@v1
        with:
          name: "SHOULD_PUBLISH"
          value: "false"
          token: ${{ secrets.VARIABLE_ASSIGNMENT }}
